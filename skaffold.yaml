apiVersion: skaffold/v2beta9
kind: Config
build:
  local:
    useBuildkit: true
  artifacts:
    - image: enforcer-k8s
      context: ./
deploy:
  helm:
    releases:
      - name: enforcer-k8s
        chartPath: rode/enforcer-k8s
        version: 0.2.0
        remote: true
        wait: true
        artifactOverrides:
          image: enforcer-k8s
        imageStrategy:
          helm: {}
        setValues:
          debug: true
          rode.insecure: true
          registryInsecureSkipVerify: true
          policyId: your-policy-id-here
profiles:
  - name: local
    activation:
      - kubeContext: docker-for-desktop
      - kubeContext: docker-desktop
    portForward:
      - resourceType: service
        resourceName: enforcer-k8s
        namespace: default
        port: 8001
        localPort: 8001
  - name: demo
    patches:
      - op: add
        path: /deploy/helm/releases/0/setValues/rode.host
        value: rode.rode-demo:50051
